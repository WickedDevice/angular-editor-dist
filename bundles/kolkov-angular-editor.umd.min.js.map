{"version":3,"sources":["../../../projects/angular-editor/src/lib/angular-editor.service.ts","../../../projects/angular-editor/src/lib/config.ts","../../../projects/angular-editor/src/lib/utils.ts","../../../projects/angular-editor/src/lib/image-resize.service.ts","../../../projects/angular-editor/src/lib/angular-editor.component.ts","../../../node_modules/tslib/tslib.es6.js","../../../projects/angular-editor/src/lib/angular-editor-toolbar.component.ts","../../../projects/angular-editor/src/lib/ae-select/ae-select.component.ts","../../../projects/angular-editor/src/lib/angular-editor.module.ts"],"names":["AngularEditorService","http","doc","_this","this","saveSelection","el","elementContainsSelection","nativeElement","getSelection","sel","getRangeAt","rangeCount","savedSelection","selectedText","toString","createRange","document","prototype","executeCommand","command","param","includes","editCmd","cmd","execCommand","createLink","url","newUrl","insertHtml","insertColor","color","where","restoreSelection","setFontName","fontName","setFontSize","fontSize","html","isHTMLInserted","Error","defaultView","isOrContainsDomElem","commonAncestorContainer","node","container","parentNode","removeAllRanges","addRange","executeInNextQueueIteration","callbackFn","timeout","setTimeout","checkSelection","length","uploadImage","file","uploadData","FormData","append","name","post","uploadUrl","reportProgress","observe","withCredentials","uploadWithCredentials","insertImage","imageUrl","div","uuid","setDefaultParagraphSeparator","separator","createCustomClass","customClass","newTag","tagName","tag","class","insertVideo","videoUrl","match","insertYouTubeVideoTag","insertVimeoVideoTag","insertArbitraryHtml","thumbnail","split","nextNode","hasChildNodes","firstChild","nextSibling","getRangeSelectedNodes","range","includePartiallySelectedContainers","startContainer","endNode","endContainer","rangeNodes","push","unshift","getSelectedNodes","nodes","i","len","apply","replaceWithOwnChildren","parent","insertBefore","removeChild","removeSelectedElements","tagNames","tagNamesArray","toLowerCase","forEach","nodeType","indexOf","Injectable","HttpClient","Inject","args","DOCUMENT","angularEditorConfig","editable","spellcheck","height","minHeight","maxHeight","width","minWidth","translate","enableToolbar","showToolbar","placeholder","defaultParagraphSeparator","defaultFontName","defaultFontSize","fonts","sanitize","toolbarPosition","outline","isDefined","value","ImageResizeService","hasBlobConstructor","Boolean","Blob","e","hasArrayBufferViewSupport","Uint8Array","size","hasToBlobSupport","HTMLCanvasElement","toBlob","hasBlobSupport","ArrayBuffer","atob","hasReaderSupport","FileReader","URL","resize","maxDimensions","callback","isSupported","type","image","createElement","onload","imgEvt","isTooLarge","scaleRatio","canvas","ctx","getContext","imageSmoothingEnabled","imageSmoothingQuality","drawImage","blob","_toBlob","_loadImage","byteString","dataURIParts","toDataURL","decodeURIComponent","arrayBuffer","intArray","charCodeAt","mimeString","reader","evt","src","target","result","readAsDataURL","createObjectURL","_toFile","theBlob","fileName","b","lastModifiedDate","Date","AngularEditorComponent","r","editorService","sanitizer","cdRef","defaultTabIndex","autoFocus","modeVisual","showPlaceholder","disabled","focused","touched","changed","id","config","markdownEmitter","EventEmitter","viewMode","blurEvent","focusEvent","tabindex","parsedTabIndex","Number","tabIndex","onFocus","focus","ngOnInit","emitMarkdown","$event","emit","ngAfterViewInit","textArea","addEventListener","plainPaste","bind","console","log","preventDefault","text","clipboardData","getData","deleteContents","insertNode","createTextNode","selection","doInsertHTML","toggleEditorMode","getCustomTags","onContentChange","exec","onTextAreaFocus","event","stopPropagation","configure","onTextAreaMouseOut","onTextAreaBlur","onTouched","relatedTarget","parentElement","classList","contains","getElementById","element","innerHTML","innerText","onChange","undefined","SecurityContext","HTML","togglePlaceholder","registerOnChange","fn","registerOnTouched","writeValue","refreshView","normalizedValue","setProperty","removeClass","editorWrapper","addClass","setDisabledState","isDisabled","action","bToSource","oContent","editableElement","createText","oPre","setStyle","oCode","appendChild","focusInstance","listen","blurInstance","querySelectorAll","selectNodeContents","editorToolbar","setEditorMode","userSelection","triggerButtons","a","focusNode","els","triggerBlocks","getFonts","map","x","label","tags","customClasses","join","ngOnDestroy","filterStyles","replace","Component","selector","template","encapsulation","ViewEncapsulation","None","providers","provide","NG_VALUE_ACCESSOR","useExisting","forwardRef","multi","Renderer2","DomSanitizer","ChangeDetectorRef","Attribute","Input","Output","ViewChild","static","HostBinding","HostListener","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","done","then","__generator","body","f","y","t","g","_","sent","trys","ops","verb","throw","return","Symbol","iterator","n","v","op","TypeError","call","pop","Object","create","__values","o","s","m","AEButtonIsHiddenPipe","transform","hiddenButtons","Array","hiddenButtons_1","hiddenButtons_1_1","arr","find","item","Pipe","pure","AngularEditorToolbarComponent","er","imageResizeSrvc","htmlMode","linkSelected","block","headings","fontSizes","customClassId","customClassList","tagMap","BLOCKQUOTE","A","select","buttons","execute","defineProperty","classes","_customClasses","triggerCommand","queryCommandState","elementById","findIndex","nodeName","found","index","Element","className","keys","foreColour","queryCommandValue","backColor","insertUrl","href","prompt","insertResource","insertResourceCallback","ret","_a","foreColor","toggleEditorModeButton","onFileChanged","files","upload","subscribe","watchUploadImage","didItResize","fr","currentTarget","srcElement","response","setCustomClass","classId","ElementRef","AeSelectComponent","elRef","options","optionId","opened","hidden","changeEvent","selectedOption","hasOwnProperty","isHidden","hide","optionSelect","option","setValue","toggleOpen","onClick","close","selectedEl","labelButton","handleKeyDown","key","_handleArrowDown","_handleArrowUp","_handleSpace","_handleEnter","_handleTab","_handleBackspace","NgModule","imports","CommonModule","FormsModule","ReactiveFormsModule","declarations","exports"],"mappings":"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","sourcesContent":["import { ElementRef, Inject, Injectable } from '@angular/core';\nimport { HttpClient, HttpEvent } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { DOCUMENT } from '@angular/common';\nimport { CustomClass } from './config';\nimport { v4 as uuid } from 'uuid';\nexport interface UploadResponse {\n  imageUrl: string;\n}\n\n@Injectable()\nexport class AngularEditorService {\n\n  savedSelection: Range | null;\n  selectedText: string;\n  uploadUrl: string;\n  uploadWithCredentials: boolean;\n\n  constructor(\n    private http: HttpClient,\n    @Inject(DOCUMENT) private doc: any\n  ) { }\n\n  /**\n   * Executed command from editor header buttons exclude toggleEditorMode\n   * @param command string from triggerCommand\n   */\n  executeCommand(command: string, param: string = null) {\n    const commands = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'pre'];\n    if (commands.includes(command)) {\n      this.editCmd('formatBlock', command);\n      return;\n    }\n    this.editCmd(command, param);\n  }\n\n  editCmd(cmd: string, param: string): boolean {\n    // console.log(`executeCommand: ${command} ${param}`);\n    // this.restoreSelection();  // Prevent lost focus issues --JCN\n    // console.log('restoring selection');\n    return !!this.doc.execCommand(cmd, false, param);\n  }\n\n  /**\n   * Create URL link\n   * @param url string from UI prompt\n   */\n  createLink(url: string) {\n    if (!url.includes('http')) {\n      this.editCmd('createlink', url);\n    } else {\n      const newUrl = '<a href=\"' + url + '\" target=\"_blank\">' + this.selectedText + '</a>';\n      this.insertHtml(newUrl);\n    }\n  }\n\n  /**\n   * insert color either font or background\n   *\n   * @param color color to be inserted\n   * @param where where the color has to be inserted either text/background\n   */\n  insertColor(color: string, where: string): void {\n    const restored = this.restoreSelection();\n    if (restored) {\n      if (where === 'textColor') {\n        this.editCmd('foreColor', color);\n      } else {\n        this.editCmd('hiliteColor', color);\n      }\n    }\n  }\n\n  /**\n   * Set font name\n   * @param fontName string\n   */\n  setFontName(fontName: string) {\n    this.editCmd('fontName', fontName);\n  }\n\n  /**\n   * Set font size\n   * @param fontSize string\n   */\n  setFontSize(fontSize: string) {\n    this.editCmd('fontSize', fontSize);\n  }\n\n  /**\n   * Create raw HTML\n   * @param html HTML string\n   */\n  insertHtml(html: string): void {\n    let isHTMLInserted = this.editCmd('insertHTML', html);\n\n    if (!isHTMLInserted) {\n      // retry...sometimes its needed\n      isHTMLInserted = this.editCmd('insertHTML', html);\n      if (!isHTMLInserted) {\n        throw new Error('Unable to perform the operation');\n      }\n    }\n  }\n\n  /**\n   * save selection when the editor is focussed out\n   */\n  public saveSelection = (el: ElementRef): void => {\n\n    if (!this.elementContainsSelection(el.nativeElement)) {\n      return; // do not save browser selections that are outside the editor\n    }\n    if (this.doc.getSelection) {\n      const sel = this.doc.getSelection();\n      if (sel.getRangeAt && sel.rangeCount) {\n        this.savedSelection = sel.getRangeAt(0);\n        this.selectedText = sel.toString();\n      }\n    } else if (this.doc.getSelection && this.doc.createRange) {\n      this.savedSelection = document.createRange();\n    } else {\n      this.savedSelection = null;\n    }\n  }\n\n  elementContainsSelection(el) {\n    if (!el) {\n      return false;\n    }\n    const view = this.doc.defaultView;\n    const sel = view.getSelection();\n\n    if (sel && sel.rangeCount > 0) {\n      return this.isOrContainsDomElem(sel.getRangeAt(0).commonAncestorContainer, el);\n    }\n    return false;\n  }\n\n  isOrContainsDomElem(node, container) {\n    while (node) {\n      if (node === container) {\n        return true;\n      }\n      node = node.parentNode;\n    }\n    return false;\n  }\n\n  /**\n   * restore selection when the editor is focused in\n   *\n   * saved selection when the editor is focused out\n   */\n  restoreSelection(): boolean {\n    if (this.savedSelection) {\n      if (this.doc.getSelection) {\n        // console.log(`***Restoring selection : ${this.savedSelection.startContainer.nodeName} ${this.savedSelection.endContainer.nodeName}`);\n        const sel = this.doc.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(this.savedSelection);\n        return true;\n      } else if (this.doc.getSelection /*&& this.savedSelection.select*/) {\n        // this.savedSelection.select();\n        return true;\n      }\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * setTimeout used for execute 'saveSelection' method in next event loop iteration\n   */\n  public executeInNextQueueIteration(callbackFn: (...args: any[]) => any, timeout = 1e2): void {\n    setTimeout(callbackFn, timeout);\n  }\n\n  /** check any selection is made or not */\n  private checkSelection(): any {\n\n    const selectedText = this.savedSelection.toString();\n\n    if (selectedText.length === 0) {\n      throw new Error('No Selection Made');\n    }\n    return true;\n  }\n\n  /**\n   * Upload file to uploadUrl\n   * @param file The file\n   */\n  uploadImage(file: File): Observable<HttpEvent<UploadResponse>> {\n\n    const uploadData: FormData = new FormData();\n\n    uploadData.append('file', file, file.name);\n\n    return this.http.post<UploadResponse>(this.uploadUrl, uploadData, {\n      reportProgress: true,\n      observe: 'events',\n      withCredentials: this.uploadWithCredentials,\n    });\n  }\n\n  /**\n   * Insert image with Url\n   * @param imageUrl The imageUrl.\n   */\n  insertImage(imageUrl: string) {\n    const id = uuid();\n    const div = `\n    <figure id=${id} style=\"text-align:center\" contenteditable=\"false\" >\n    <img src=\"${imageUrl}\"   style=\"margin:0 auto\">\n    </figure>\n    <br>\n    `;\n    this.insertHtml(div);\n    // this.doc.getElementById(`close-${id}`).addEventListener('click', () => {\n    //   const ele = this.doc.getElementById(id);\n    //   if (ele) {\n    //     ele.remove();\n    //   }\n    // })\n  }\n\n  setDefaultParagraphSeparator(separator: string) {\n    this.editCmd('defaultParagraphSeparator', separator);\n  }\n\n  createCustomClass(customClass: CustomClass) {\n    let newTag = this.selectedText;\n    if (customClass) {\n      const tagName = customClass.tag ? customClass.tag : 'span';\n      newTag = '<' + tagName + ' class=\"' + customClass.class + '\">' + this.selectedText + '</' + tagName + '>';\n    }\n    this.insertHtml(newTag);\n  }\n\n  insertVideo(videoUrl: string) {\n    if (videoUrl.match('www.youtube.com')) {\n      this.insertYouTubeVideoTag(videoUrl);\n    }\n    if (videoUrl.match('vimeo.com')) {\n      this.insertVimeoVideoTag(videoUrl);\n    }\n  }\n\n  insertArbitraryHtml(html: string) {\n    this.insertHtml(html);\n  }\n\n  private insertYouTubeVideoTag(videoUrl: string): void {\n    const id = videoUrl.split('v=')[1];\n    const thumbnail = `\n    <iframe width=\"560\" height=\"315\"\n    src=\"https://www.youtube.com/embed/${id}\"\n    frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n    allowfullscreen></iframe>\n    <br>\n    `;\n    this.insertHtml(thumbnail);\n  }\n\n  private insertVimeoVideoTag(videoUrl: string): void {\n    const id = videoUrl.split('.com/')[1];\n    const thumbnail = `<iframe src=\"https://player.vimeo.com/video/${id}\"\n    width=\"640\" height=\"360\" frameborder=\"0\" allow=\"autoplay; fullscreen; picture-in-picture\" all owfullscreen></iframe>\n    <br>`;\n    // const sub = this.http.get<any>(`https://vimeo.com/api/oembed.json?url=${videoUrl}`).subscribe(data => {\n    //   const imageUrl = data.thumbnail_url_with_play_button;\n    //   const thumbnail = `\n    //   <iframe width=\"560\" height=\"315\"\n    //   src=\"https://www.youtube.com/embed/${id}\"\n    //   frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n    //   allowfullscreen></iframe>\n    //   `;\n    //   this.insertHtml(thumbnail);\n    //   sub.unsubscribe();\n    // });\n    this.insertHtml(thumbnail);\n  }\n\n  nextNode(node) {\n    if (node.hasChildNodes()) {\n      return node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n        node = node.parentNode;\n      }\n      if (!node) {\n        return null;\n      }\n      return node.nextSibling;\n    }\n  }\n\n  getRangeSelectedNodes(range, includePartiallySelectedContainers) {\n    let node = range.startContainer;\n    const endNode = range.endContainer;\n    let rangeNodes = [];\n\n    // Special case for a range that is contained within a single node\n    if (node === endNode) {\n      rangeNodes = [node];\n    } else {\n      // Iterate nodes until we hit the end container\n      while (node && node !== endNode) {\n        rangeNodes.push(node = this.nextNode(node));\n      }\n\n      // Add partially selected nodes at the start of the range\n      node = range.startContainer;\n      while (node && node !== range.commonAncestorContainer) {\n        rangeNodes.unshift(node);\n        node = node.parentNode;\n      }\n    }\n\n    // Add ancestors of the range container, if required\n    if (includePartiallySelectedContainers) {\n      node = range.commonAncestorContainer;\n      while (node) {\n        rangeNodes.push(node);\n        node = node.parentNode;\n      }\n    }\n\n    return rangeNodes;\n  }\n\n  getSelectedNodes() {\n    const nodes = [];\n    if (this.doc.getSelection) {\n      const sel = this.doc.getSelection();\n      for (let i = 0, len = sel.rangeCount; i < len; ++i) {\n        nodes.push.apply(nodes, this.getRangeSelectedNodes(sel.getRangeAt(i), true));\n      }\n    }\n    return nodes;\n  }\n\n  replaceWithOwnChildren(el) {\n    const parent = el.parentNode;\n    while (el.hasChildNodes()) {\n      parent.insertBefore(el.firstChild, el);\n    }\n    parent.removeChild(el);\n  }\n\n  removeSelectedElements(tagNames) {\n    const tagNamesArray = tagNames.toLowerCase().split(',');\n    this.getSelectedNodes().forEach((node) => {\n      if (node.nodeType === 1 &&\n        tagNamesArray.indexOf(node.tagName.toLowerCase()) > -1) {\n        // Remove the node and replace it with its children\n        this.replaceWithOwnChildren(node);\n      }\n    });\n  }\n}\n","import { UploadResponse } from './angular-editor.service';\nimport { HttpEvent } from '@angular/common/http';\nimport { Observable } from 'rxjs';\n\nexport interface CustomClass {\n  name: string;\n  class: string;\n  tag?: string;\n}\n\nexport interface Font {\n  name: string;\n  class: string;\n}\n\nexport interface AngularEditorConfig {\n  editable?: boolean;\n  spellcheck?: boolean;\n  height?: 'auto' | string;\n  minHeight?: '0' | string;\n  maxHeight?: 'auto' | string;\n  width?: 'auto' | string;\n  minWidth?: '0' | string;\n  translate?: 'yes' | 'now' | string;\n  enableToolbar?: boolean;\n  showToolbar?: boolean;\n  placeholder?: string;\n  defaultParagraphSeparator?: string;\n  defaultFontName?: string;\n  defaultFontSize?: '1' | '2' | '3' | '4' | '5' | '6' | '7' | string;\n  uploadUrl?: string;\n  upload?: (file: File) => Observable<HttpEvent<UploadResponse>>;\n  uploadWithCredentials?: boolean;\n  fonts?: Font[];\n  customClasses?: CustomClass[];\n  sanitize?: boolean;\n  toolbarPosition?: 'top' | 'bottom';\n  outline?: boolean;\n  toolbarHiddenButtons?: string[][];\n  toolbarInsertResourceCallback?: (string) => string;\n}\n\nexport const angularEditorConfig: AngularEditorConfig = {\n  editable: true,\n  spellcheck: true,\n  height: 'auto',\n  minHeight: '0',\n  maxHeight: 'auto',\n  width: 'auto',\n  minWidth: '0',\n  translate: 'yes',\n  enableToolbar: true,\n  showToolbar: true,\n  placeholder: 'Enter text here...',\n  defaultParagraphSeparator: '',\n  defaultFontName: '',\n  defaultFontSize: '',\n  fonts: [\n    {class: 'arial', name: 'Arial'},\n    {class: 'times-new-roman', name: 'Times New Roman'},\n    {class: 'calibri', name: 'Calibri'},\n    {class: 'comic-sans-ms', name: 'Comic Sans MS'}\n  ],\n  uploadUrl: 'v1/image',\n  uploadWithCredentials: false,\n  sanitize: true,\n  toolbarPosition: 'top',\n  outline: true,\n  /*toolbarHiddenButtons: [\n    ['bold', 'italic', 'underline', 'strikeThrough', 'superscript', 'subscript'],\n    ['heading', 'fontName', 'fontSize', 'color'],\n    ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull', 'indent', 'outdent'],\n    ['cut', 'copy', 'delete', 'removeFormat', 'undo', 'redo'],\n    ['paragraph', 'blockquote', 'removeBlockquote', 'horizontalLine', 'orderedList', 'unorderedList'],\n    ['link', 'unlink', 'image', 'video']\n  ]*/\n};\n","export function isDefined(value: any) {\n  return value !== undefined && value !== null;\n}\n","import { Inject, Injectable } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\n\n@Injectable()\nexport class ImageResizeService {\n  hasBlobConstructor = typeof (Blob) !== 'undefined' && (function () {\n    try {\n      return Boolean(new Blob());\n    } catch (e) {\n      return false;\n    }\n  }());\n\n  hasArrayBufferViewSupport = this.hasBlobConstructor && typeof (Uint8Array) !== 'undefined' && (function () {\n    try {\n      return new Blob([new Uint8Array(100)]).size === 100;\n    } catch (e) {\n      return false;\n    }\n  }());\n\n  hasToBlobSupport = (typeof HTMLCanvasElement !== 'undefined' ? HTMLCanvasElement.prototype.toBlob : false);\n\n  hasBlobSupport = (this.hasToBlobSupport ||\n    (typeof Uint8Array !== 'undefined' && typeof ArrayBuffer !== 'undefined' && typeof atob !== 'undefined'));\n\n  hasReaderSupport = (typeof FileReader !== 'undefined' || typeof URL !== 'undefined');\n\n  constructor() { }\n\n  resize(file: File, maxDimensions: { width: number, height: number }, callback) {\n    if (typeof maxDimensions === 'function') {\n      callback = maxDimensions;\n      maxDimensions = {\n        width: 640,\n        height: 480\n      };\n    }\n\n\n    if (!this.isSupported() || !file.type.match(/image.*/)) {\n      callback(file, false);\n      return false;\n    }\n\n    if (file.type.match(/image\\/gif/)) {\n      // Not attempting, could be an animated gif\n      callback(file, false);\n      // TODO: use https://github.com/antimatter15/whammy to convert gif to webm\n      return false;\n    }\n\n    const image = document.createElement('img');\n\n    image.onload = (imgEvt) => {\n      let width = image.width;\n      let height = image.height;\n      let isTooLarge = false;\n\n      if (width >= height && width > maxDimensions.width) {\n        isTooLarge = true;\n      } else if (height > maxDimensions.height) {\n        isTooLarge = true;\n      }\n\n      if (!isTooLarge) {\n        // early exit; no need to resize\n        callback(file, false);\n        return;\n      }\n\n      const scaleRatio = maxDimensions.width / width;\n\n      // TODO number of resampling steps\n      // const steps = Math.ceil(Math.log(width / (width * scaleRatio)) / Math.log(2));\n\n      width *= scaleRatio;\n      height *= scaleRatio;\n\n      const canvas = document.createElement('canvas');\n      canvas.width = width;\n      canvas.height = height;\n\n      const ctx = canvas.getContext('2d');\n      ctx.imageSmoothingEnabled = true;\n      (ctx as any).imageSmoothingQuality = 'high';\n      ctx.drawImage(image, 0, 0, width, height);\n\n      if (this.hasToBlobSupport) {\n        canvas.toBlob((blob) => {\n          callback(blob, true);\n        }, file.type);\n      } else {\n        const blob = this._toBlob(canvas, file.type);\n        callback(blob, true);\n      }\n    };\n    this._loadImage(image, file);\n\n    return true;\n  }\n\n  isSupported() {\n    return (\n      (typeof (HTMLCanvasElement) !== 'undefined')\n      && this.hasBlobSupport\n      && this.hasReaderSupport\n    );\n  }\n\n  _toBlob(canvas, type) {\n    const dataURI = canvas.toDataURL(type);\n    const dataURIParts = dataURI.split(',');\n    let byteString;\n    if (dataURIParts[0].indexOf('base64') >= 0) {\n      // Convert base64 to raw binary data held in a string:\n      byteString = atob(dataURIParts[1]);\n    } else {\n      // Convert base64/URLEncoded data component to raw binary data:\n      byteString = decodeURIComponent(dataURIParts[1]);\n    }\n    const arrayBuffer = new ArrayBuffer(byteString.length);\n    const intArray = new Uint8Array(arrayBuffer);\n\n    for (let i = 0; i < byteString.length; i += 1) {\n      intArray[i] = byteString.charCodeAt(i);\n    }\n\n    const mimeString = dataURIParts[0].split(':')[1].split(';')[0];\n    let blob = null;\n\n    if (this.hasBlobConstructor) {\n      blob = new Blob(\n        [this.hasArrayBufferViewSupport ? intArray : arrayBuffer],\n        { type: mimeString }\n      );\n    } else {\n      blob = new Blob([arrayBuffer]);\n    }\n    return blob;\n  }\n\n  _loadImage(image, file, callback?: any) {\n    if (typeof (URL) === 'undefined') {\n      const reader = new FileReader();\n      reader.onload = function (evt) {\n        image.src = (evt.target as any).result;\n        if (callback) { callback(); }\n      };\n      reader.readAsDataURL(file);\n    } else {\n      image.src = URL.createObjectURL(file);\n      if (callback) {\n        callback();\n      }\n    }\n  }\n\n  _toFile(theBlob: Blob, fileName: string): File {\n    const b: any = theBlob;\n    b.lastModifiedDate = new Date();\n    b.name = fileName;\n    return <File>theBlob;\n  }\n}\n","import {\n  AfterViewInit,\n  Attribute,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  forwardRef,\n  HostBinding,\n  HostListener,\n  Inject,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  Renderer2,\n  SecurityContext,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport {ControlValueAccessor, NG_VALUE_ACCESSOR} from '@angular/forms';\nimport {AngularEditorConfig, angularEditorConfig} from './config';\nimport {AngularEditorToolbarComponent} from './angular-editor-toolbar.component';\nimport {AngularEditorService} from './angular-editor.service';\nimport {DOCUMENT} from '@angular/common';\nimport {DomSanitizer} from '@angular/platform-browser';\nimport {isDefined} from './utils';\nimport { ImageResizeService } from './image-resize.service';\n\n@Component({\n  selector: 'angular-editor',\n  templateUrl: './angular-editor.component.html',\n  styleUrls: ['./angular-editor.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => AngularEditorComponent),\n      multi: true\n    },\n    AngularEditorService,\n    ImageResizeService\n  ]\n})\nexport class AngularEditorComponent implements OnInit, ControlValueAccessor, AfterViewInit, OnDestroy {\n\n  private onChange: (value: string) => void;\n  private onTouched: () => void;\n\n  modeVisual = true;\n  showPlaceholder = false;\n  disabled = false;\n  focused = false;\n  touched = false;\n  changed = false;\n\n  focusInstance: any;\n  blurInstance: any;\n\n  @Input() id = '';\n  @Input() config: AngularEditorConfig = angularEditorConfig;\n  @Input() placeholder = '';\n  @Input() tabIndex: number | null;\n\n  @Output() html;\n  @Output() markdownEmitter = new EventEmitter<boolean>();\n  @ViewChild('editor', {static: true}) textArea: ElementRef;\n  @ViewChild('editorWrapper', {static: true}) editorWrapper: ElementRef;\n  @ViewChild('editorToolbar', {static: true}) editorToolbar: AngularEditorToolbarComponent;\n\n  @Output() viewMode = new EventEmitter<boolean>();\n\n  /** emits `blur` event when focused out from the textarea */\n    // tslint:disable-next-line:no-output-native no-output-rename\n  @Output('blur') blurEvent: EventEmitter<FocusEvent> = new EventEmitter<FocusEvent>();\n\n  /** emits `focus` event when focused in to the textarea */\n    // tslint:disable-next-line:no-output-rename no-output-native\n  @Output('focus') focusEvent: EventEmitter<FocusEvent> = new EventEmitter<FocusEvent>();\n\n  @HostBinding('attr.tabindex') tabindex = -1;\n\n  @HostListener('focus')\n  onFocus() {\n    this.focus();\n  }\n\n  constructor(\n    private r: Renderer2,\n    public editorService: AngularEditorService,\n    @Inject(DOCUMENT) private doc: any,\n    private sanitizer: DomSanitizer,\n    private cdRef: ChangeDetectorRef,\n    @Attribute('tabindex') defaultTabIndex: string,\n    @Attribute('autofocus') private autoFocus: any\n  ) {\n    const parsedTabIndex = Number(defaultTabIndex);\n    this.tabIndex = (parsedTabIndex || parsedTabIndex === 0) ? parsedTabIndex : null;\n  }\n\n  ngOnInit() {\n    this.config.toolbarPosition = this.config.toolbarPosition ? this.config.toolbarPosition : angularEditorConfig.toolbarPosition;\n  }\n\n  emitMarkdown($event) {\n    this.markdownEmitter.emit($event);\n  }\n  ngAfterViewInit() {\n    // Replace normal Paste with Paste Plain Text to simplify UX --JCN\n    this.textArea.nativeElement.addEventListener('paste', this.plainPaste.bind(this));\n\n    if (isDefined(this.autoFocus)) {\n      this.focus();\n    }\n  }\n\n  plainPaste(e: any) {\n    console.log();\n    e.preventDefault();\n    let text = '';\n\n    if (e.clipboardData && e.clipboardData.getData) {\n      text = e.clipboardData.getData('text/plain');\n      this.doc.execCommand('insertHTML', false, text);\n    } else if (this.doc.defaultView.clipboardData && this.doc.defaultView.clipboardData.getData) {\n      text = this.doc.defaultView.clipboardData.getData('Text');\n      if (this.doc.defaultView.getSelection) {\n        const sel = this.doc.defaultView.getSelection();\n        if (sel.getRangeAt && sel.rangeCount) {\n          const range = sel.getRangeAt(0);\n          range.deleteContents();\n          range.insertNode(this.doc.createTextNode(text));\n        }\n      } else if (this.doc.selection && this.doc.selection.createRange) {\n        this.doc.selection.createRange().text = text;\n      }\n    }\n  }\n\n  doInsertHTML(name: string) {\n    this.editorService.executeCommand('insertHTML', name);\n  }\n\n  /**\n   * Executed command from editor header buttons\n   * @param command string from triggerCommand\n   */\n  executeCommand(command: string) {\n    console.log(`***Execute command: ${command}`);\n\n    this.focus();\n    if (command === 'focus') {\n      return;\n    }\n    if (command === 'toggleEditorMode') {\n      this.toggleEditorMode(this.modeVisual);\n    } else if (command !== '') {\n      if (command === 'clear') {\n        this.editorService.removeSelectedElements(this.getCustomTags());\n        this.onContentChange(this.textArea.nativeElement);\n      } else if (command === 'default') {\n        this.editorService.removeSelectedElements('h1,h2,h3,h4,h5,h6,p,pre');\n        this.onContentChange(this.textArea.nativeElement);\n      } else {\n        this.editorService.executeCommand(command);\n      }\n      this.exec();\n    }\n  }\n\n  /**\n   * focus event\n   */\n  onTextAreaFocus(event: FocusEvent): void {\n    // this.focusEvent.emit(event);  // Hack: I think I need this --JCN\n    if (this.focused) {\n      event.stopPropagation();\n      return;\n    }\n    this.focused = true;\n    // console.log(`onTextAreaFocus() setting focused to ${this.focused} for id ${this.id}`);\n    this.focusEvent.emit(event);\n    if (!this.touched || !this.changed) {\n      this.editorService.executeInNextQueueIteration(() => {\n        this.configure();\n        this.touched = true;\n      });\n    }\n  }\n\n  /**\n   * @description fires when cursor leaves textarea\n   */\n  public onTextAreaMouseOut(event: MouseEvent): void {\n    this.editorService.saveSelection(this.textArea);\n  }\n\n  /**\n   * blur event\n   */\n  onTextAreaBlur(event: FocusEvent) {\n    /**\n     * save selection if focussed out\n     */\n    // this.editorService.executeInNextQueueIteration(this.editorService.saveSelection);\n    // Changing from async to sync here seemed to fix an \"unfocused\" problem\n    this.editorService.saveSelection(this.textArea);\n\n    if (typeof this.onTouched === 'function') {\n      this.onTouched();\n    }\n\n    if (event.relatedTarget !== null) {\n      const parent = (event.relatedTarget as HTMLElement).parentElement;\n      if (!parent.classList.contains('angular-editor-toolbar-set') && !parent.classList.contains('ae-picker')) {\n        this.blurEvent.emit(event);\n        this.focused = false;\n        // console.log(`onTextAreaBlur() setting focused to ${this.focused} for id ${this.id}`);\n      }\n    } else {  // Added by JCN (user clicked on random surface somewhere)\n      this.blurEvent.emit(event);\n      this.focused = false;\n      // console.log(`onTextAreaBlur() setting focused to ${this.focused} for id ${this.id} (related target null)`);\n    }\n  }\n\n  /**\n   *  focus the text area when the editor is focused\n   */\n  focus() {\n    if (this.modeVisual) {\n      this.editorService.restoreSelection();\n      this.textArea.nativeElement.focus();\n    } else {\n      const sourceText = this.doc.getElementById('sourceText' + this.id);\n      sourceText.focus();\n      this.focused = true;\n      // console.log(`focus() setting focused to ${this.focused} for id ${this.id}`);\n    }\n  }\n\n  /**\n   * Executed from the contenteditable section while the input property changes\n   * @param element html element from contenteditable\n   */\n  onContentChange(element: HTMLElement): void {\n    let html = '';\n    if (this.modeVisual) {\n      html = element.innerHTML;\n    } else {\n      html = element.innerText;\n    }\n    if ((!html || html === '<br>')) {\n      html = '';\n    }\n    if (typeof this.onChange === 'function') {\n      this.onChange(this.config.sanitize || this.config.sanitize === undefined ?\n        this.sanitizer.sanitize(SecurityContext.HTML, html) : html);\n      if ((!html) !== this.showPlaceholder) {\n        this.togglePlaceholder(this.showPlaceholder);\n      }\n    }\n    this.changed = true;\n  }\n\n  /**\n   * Set the function to be called\n   * when the control receives a change event.\n   *\n   * @param fn a function\n   */\n  registerOnChange(fn: any): void {\n    this.onChange = e => (e === '<br>' ? fn('') : fn(e)) ;\n  }\n\n  /**\n   * Set the function to be called\n   * when the control receives a touch event.\n   *\n   * @param fn a function\n   */\n  registerOnTouched(fn: any): void {\n    this.onTouched = fn;\n  }\n\n  /**\n   * Write a new value to the element.\n   *\n   * @param value value to be executed when there is a change in contenteditable\n   */\n  writeValue(value: any): void {\n\n    if ((!value || value === '<br>' || value === '') !== this.showPlaceholder) {\n      this.togglePlaceholder(this.showPlaceholder);\n    }\n\n    if (value === undefined || value === '' || value === '<br>') {\n      value = null;\n    }\n\n    this.refreshView(value);\n  }\n\n  /**\n   * refresh view/HTML of the editor\n   *\n   * @param value html string from the editor\n   */\n  refreshView(value: string): void {\n    const normalizedValue = value === null ? '' : value;\n    this.r.setProperty(this.textArea.nativeElement, 'innerHTML', normalizedValue);\n\n    return;\n  }\n\n  /**\n   * toggles placeholder based on input string\n   *\n   * @param value A HTML string from the editor\n   */\n  togglePlaceholder(value: boolean): void {\n    if (!value) {\n      this.r.addClass(this.editorWrapper.nativeElement, 'show-placeholder');\n      this.showPlaceholder = true;\n\n    } else {\n      this.r.removeClass(this.editorWrapper.nativeElement, 'show-placeholder');\n      this.showPlaceholder = false;\n    }\n  }\n\n  /**\n   * Implements disabled state for this element\n   *\n   * @param isDisabled Disabled flag\n   */\n  setDisabledState(isDisabled: boolean): void {\n    const div = this.textArea.nativeElement;\n    const action = isDisabled ? 'addClass' : 'removeClass';\n    this.r[action](div, 'disabled');\n    this.disabled = isDisabled;\n  }\n\n  /**\n   * toggles editor mode based on bToSource bool\n   *\n   * @param bToSource A boolean value from the editor\n   */\n  toggleEditorMode(bToSource: boolean) {\n    let oContent: any;\n    const editableElement = this.textArea.nativeElement;\n\n    if (bToSource) {\n      oContent = this.r.createText(editableElement.innerHTML);\n      this.r.setProperty(editableElement, 'innerHTML', '');\n      this.r.setProperty(editableElement, 'contentEditable', false);\n\n      const oPre = this.r.createElement('pre');\n      this.r.setStyle(oPre, 'margin', '0');\n      this.r.setStyle(oPre, 'outline', 'none');\n\n      const oCode = this.r.createElement('code');\n      this.r.setProperty(oCode, 'id', 'sourceText' + this.id);\n      this.r.setStyle(oCode, 'display', 'block');\n      this.r.setStyle(oCode, 'white-space', 'pre-wrap');\n      this.r.setStyle(oCode, 'word-break', 'keep-all');\n      this.r.setStyle(oCode, 'outline', 'none');\n      this.r.setStyle(oCode, 'margin', '0');\n      this.r.setStyle(oCode, 'background-color', '#fff5b9');\n      this.r.setProperty(oCode, 'contentEditable', true);\n      this.r.appendChild(oCode, oContent);\n      this.focusInstance = this.r.listen(oCode, 'focus', (event) => this.onTextAreaFocus(event));\n      this.blurInstance = this.r.listen(oCode, 'blur', (event) => this.onTextAreaBlur(event));\n      this.r.appendChild(oPre, oCode);\n      this.r.appendChild(editableElement, oPre);\n\n      // ToDo move to service\n\n      // paragraph seems better --JN\n      this.doc.execCommand('defaultParagraphSeparator', false, 'p');\n      // this.doc.execCommand('defaultParagraphSeparator', false, 'div');\n\n      this.modeVisual = false;\n      this.viewMode.emit(false);\n      oCode.focus();\n    } else {\n      if (this.doc.querySelectorAll) {\n        this.r.setProperty(editableElement, 'innerHTML', editableElement.innerText);\n      } else {\n        oContent = this.doc.createRange();\n        oContent.selectNodeContents(editableElement.firstChild);\n        this.r.setProperty(editableElement, 'innerHTML', oContent.toString());\n      }\n      this.r.setProperty(editableElement, 'contentEditable', true);\n      this.modeVisual = true;\n      this.viewMode.emit(true);\n      this.onContentChange(editableElement);\n      editableElement.focus();\n    }\n    this.editorToolbar.setEditorMode(!this.modeVisual);\n  }\n\n  /**\n   * toggles editor buttons when cursor moved or positioning\n   *\n   * Send a node array from the contentEditable of the editor\n   */\n  exec() {\n    if (this.editorToolbar && this.editorToolbar.triggerButtons) {\n      this.editorToolbar.triggerButtons();\n    }\n\n    let userSelection;\n    if (this.doc.getSelection) {\n      userSelection = this.doc.getSelection();\n      this.editorService.executeInNextQueueIteration(this.editorService.saveSelection.bind(this, this.textArea));\n    }\n\n    let a = userSelection.focusNode;\n    const els = [];\n    while (a && a.id !== 'editor') {\n      els.unshift(a);\n      a = a.parentNode;\n    }\n    if (this.editorToolbar && this.editorToolbar.triggerBlocks) {\n      this.editorToolbar.triggerBlocks(els);\n    }\n  }\n\n  private configure() {\n    this.editorService.uploadUrl = this.config.uploadUrl;\n    this.editorService.uploadWithCredentials = this.config.uploadWithCredentials;\n    if (this.config.defaultParagraphSeparator) {\n      this.editorService.setDefaultParagraphSeparator(this.config.defaultParagraphSeparator);\n    }\n    if (this.config.defaultFontName) {\n      this.editorService.setFontName(this.config.defaultFontName);\n    }\n    if (this.config.defaultFontSize) {\n      this.editorService.setFontSize(this.config.defaultFontSize);\n    }\n  }\n\n  getFonts() {\n    const fonts = this.config.fonts ? this.config.fonts : angularEditorConfig.fonts;\n    return fonts.map(x => {\n      return {label: x.name, value: x.name};\n    });\n  }\n\n  getCustomTags() {\n    const tags = ['span'];\n    this.config.customClasses.forEach(x => {\n      if (x.tag !== undefined) {\n        if (!tags.includes(x.tag)) {\n          tags.push(x.tag);\n        }\n      }\n    });\n    return tags.join(',');\n  }\n\n  ngOnDestroy() {\n    if (this.blurInstance) {\n      this.blurInstance();\n    }\n    if (this.focusInstance) {\n      this.focusInstance();\n    }\n  }\n\n  filterStyles(html: string): string {\n    html = html.replace('position: fixed;', '');\n    return html;\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { Component, ElementRef, EventEmitter, Inject, Input, Output, Pipe, PipeTransform, Renderer2, ViewChild } from '@angular/core';\nimport { AngularEditorService, UploadResponse } from './angular-editor.service';\nimport { HttpResponse, HttpEvent } from '@angular/common/http';\nimport { DOCUMENT } from '@angular/common';\nimport { CustomClass } from './config';\nimport { SelectOption } from './ae-select/ae-select.component';\nimport { Observable } from 'rxjs';\nimport { ImageResizeService } from './image-resize.service';\n\n@Pipe({\n  name: 'buttonIsHidden',\n  pure: true\n}) export class AEButtonIsHiddenPipe implements PipeTransform {\n\n  transform(name: string, hiddenButtons: any) {\n    if (!name) {\n      return false;\n    }\n    if (!(hiddenButtons instanceof Array)) {\n      return false;\n    }\n    let result: any;\n    for (const arr of hiddenButtons) {\n      if (arr instanceof Array) {\n        result = arr.find(item => item === name);\n      }\n      if (result) {\n        break;\n      }\n    }\n    return result !== undefined;\n  }\n}\n\n@Component({\n  selector: 'angular-editor-toolbar',\n  templateUrl: './angular-editor-toolbar.component.html',\n  styleUrls: ['./angular-editor-toolbar.component.scss'],\n})\n\nexport class AngularEditorToolbarComponent {\n  htmlMode = false;\n  linkSelected = false;\n  block = 'default';\n  fontName = 'Times New Roman';\n  fontSize = '3';\n  foreColour;\n  backColor;\n\n  headings: SelectOption[] = [\n    {\n      label: 'Heading 1',\n      value: 'h1',\n    },\n    {\n      label: 'Heading 2',\n      value: 'h2',\n    },\n    {\n      label: 'Paragraph',\n      value: 'p',\n    },\n    {\n      label: 'Predefined',\n      value: 'pre'\n    },\n    {\n      label: 'Standard',\n      value: 'div'\n    },\n    {\n      label: 'default',\n      value: 'default'\n    }\n  ];\n\n  fontSizes: SelectOption[] = [\n    {\n      label: '1',\n      value: '1',\n    },\n    {\n      label: '2',\n      value: '2',\n    },\n    {\n      label: '3',\n      value: '3',\n    },\n    {\n      label: '4',\n      value: '4',\n    },\n    {\n      label: '5',\n      value: '5',\n    },\n    {\n      label: '6',\n      value: '6',\n    },\n    {\n      label: '7',\n      value: '7',\n    }\n  ];\n\n  customClassId = '-1';\n  // tslint:disable-next-line:variable-name\n  _customClasses: CustomClass[];\n  customClassList: SelectOption[] = [{ label: '', value: '' }];\n  // uploadUrl: string;\n\n  tagMap = {\n    BLOCKQUOTE: 'indent',\n    A: 'link'\n  };\n\n  select = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'PRE', 'DIV'];\n\n  // buttons = ['bold', 'italic', 'underline', 'strikeThrough', 'subscript', 'superscript', 'justifyLeft', 'justifyCenter',\n  //   'justifyRight', 'justifyFull', 'indent', 'outdent', 'insertUnorderedList', 'insertOrderedList', 'link'];\n\n  buttons = ['bold', 'italic', 'underline', 'subscript', 'superscript', 'justifyLeft', 'justifyCenter',\n    'justifyRight', 'justifyFull', 'indent', 'outdent', 'insertUnorderedList', 'insertOrderedList', 'link'];\n\n  @Input() id: string;\n  @Input() uploadUrl: string;\n  @Input() upload: (file: File) => Observable<HttpEvent<UploadResponse>>;\n  @Input() showToolbar: boolean;\n  @Input() fonts: SelectOption[] = [{ label: '', value: '' }];\n\n  @Input()\n  set customClasses(classes: CustomClass[]) {\n    if (classes) {\n      this._customClasses = classes;\n      this.customClassList = this._customClasses.map((x, i) => ({ label: x.name, value: i.toString() }));\n      this.customClassList.unshift({ label: 'Clear Class', value: '-1' });\n    }\n  }\n\n  @Input()\n  set defaultFontName(value: string) {\n    if (value) {\n      this.fontName = value;\n    }\n  }\n\n  @Input()\n  set defaultFontSize(value: string) {\n    if (value) {\n      this.fontSize = value;\n    }\n  }\n\n  @Input() hiddenButtons: string[][];\n  @Input() insertResourceCallback: (string) => string;\n\n  @Output() execute: EventEmitter<string> = new EventEmitter<string>();\n  @Output() markdownEmitter: EventEmitter<boolean> = new EventEmitter<boolean>();\n  @ViewChild('fileInput', { static: true }) myInputFile: ElementRef;\n\n  public get isLinkButtonDisabled(): boolean {\n    return this.htmlMode || !Boolean(this.editorService.selectedText);\n  }\n\n  constructor(\n    private r: Renderer2,\n    private editorService: AngularEditorService,\n    private er: ElementRef,\n    private imageResizeSrvc: ImageResizeService,\n    @Inject(DOCUMENT) private doc: any\n  ) {\n  }\n\n  /**\n   * Trigger command from editor header buttons\n   * @param command string from toolbar buttons\n   */\n  triggerCommand(command: string) {\n    this.execute.emit(command);\n  }\n\n  /**\n   * highlight editor buttons when cursor moved or positioning\n   */\n  triggerButtons() {\n    if (!this.showToolbar) {\n      return;\n    }\n    this.buttons.forEach(e => {\n      const result = this.doc.queryCommandState(e);\n      const elementById = this.doc.getElementById(e + '-' + this.id);\n      if (result && elementById) {\n        this.r.addClass(elementById, 'active');\n      } else {\n        this.r.removeClass(elementById, 'active');\n      }\n    });\n  }\n\n  /**\n   * trigger highlight editor buttons when cursor moved or positioning in block\n   */\n  triggerBlocks(nodes: Node[]) {\n    if (!this.showToolbar) {\n      return;\n    }\n    this.linkSelected = nodes.findIndex(x => x.nodeName === 'A') > -1;\n    let found = false;\n    this.select.forEach(y => {\n      const node = nodes.find(x => x.nodeName === y);\n      if (node !== undefined && y === node.nodeName) {\n        if (found === false) {\n          this.block = node.nodeName.toLowerCase();\n          found = true;\n        }\n      } else if (found === false) {\n        this.block = 'default';\n      }\n    });\n\n    found = false;\n    if (this._customClasses) {\n      this._customClasses.forEach((y, index) => {\n        const node = nodes.find(x => {\n          if (x instanceof Element) {\n            return x.className === y.class;\n          }\n        });\n        if (node !== undefined) {\n          if (found === false) {\n            this.customClassId = index.toString();\n            found = true;\n          }\n        } else if (found === false) {\n          this.customClassId = '-1';\n        }\n      });\n    }\n\n    Object.keys(this.tagMap).map(e => {\n      const elementById = this.doc.getElementById(this.tagMap[e] + '-' + this.id);\n      const node = nodes.find(x => x.nodeName === e);\n      if (node !== undefined && e === node.nodeName) {\n        this.r.addClass(elementById, 'active');\n      } else {\n        this.r.removeClass(elementById, 'active');\n      }\n    });\n\n    this.foreColour = this.doc.queryCommandValue('ForeColor');\n    this.fontSize = this.doc.queryCommandValue('FontSize');\n    this.fontName = this.doc.queryCommandValue('FontName').replace(/\"/g, '');\n    this.backColor = this.doc.queryCommandValue('backColor');\n  }\n\n  /**\n   * insert URL link\n   */\n  insertUrl() {\n    let url = 'https:\\/\\/';\n    const selection = this.editorService.savedSelection;\n    if (selection && selection.commonAncestorContainer.parentElement.nodeName === 'A') {\n      const parent = selection.commonAncestorContainer.parentElement as HTMLAnchorElement;\n      if (parent.href !== '') {\n        url = parent.href;\n      }\n    }\n    url = prompt('Insert URL link', url);\n    if (url && url !== '' && url !== 'https://') {\n      this.editorService.createLink(url);\n    }\n  }\n\n  /**\n   * insert Video link\n   */\n  insertVideo() {\n    this.execute.emit('');\n    const url = prompt('Insert Video link', `https://`);\n    if (url && url !== '' && url !== `https://`) {\n      this.editorService.insertVideo(url);\n    }\n  }\n\n  async insertResource() {\n    if (this.insertResourceCallback) {\n      const ret = await this.insertResourceCallback(this.editorService.selectedText);\n      if (typeof ret === 'string') {\n        this.editorService.insertArbitraryHtml(ret);\n      }\n    }\n  }\n\n  /** insert color */\n  insertColor(color: string, where: string) {\n    this.editorService.insertColor(color, where);\n    this.execute.emit('');\n  }\n\n  /**\n   * set font Name/family\n   * @param foreColor string\n   */\n  setFontName(foreColor: string): void {\n    this.editorService.setFontName(foreColor);\n    this.execute.emit('');\n  }\n\n  /**\n   * set font Size\n   * @param fontSize string\n   */\n  setFontSize(fontSize: string): void {\n    this.editorService.setFontSize(fontSize);\n    this.execute.emit('');\n  }\n\n  /**\n   * toggle editor mode (WYSIWYG or SOURCE)\n   * @param m boolean\n   */\n  setEditorMode(m: boolean) {\n    const toggleEditorModeButton = this.doc.getElementById('toggleEditorMode' + '-' + this.id);\n    if (m) {\n      this.r.addClass(toggleEditorModeButton, 'active');\n    } else {\n      this.r.removeClass(toggleEditorModeButton, 'active');\n    }\n    this.htmlMode = m;\n  }\n\n  /**\n   * Upload image when file is selected.\n   */\n  onFileChanged(event) {\n    const file = event.target.files[0];\n    if (file.type.includes('image/')) {\n      if (this.upload) {\n        this.upload(file).subscribe(() => this.watchUploadImage);\n      } else if (this.uploadUrl) {\n        this.editorService.uploadImage(file).subscribe(() => this.watchUploadImage);\n      } else {\n        this.imageResizeSrvc.resize(file, { width: 360, height: 240 }, (blob, didItResize) => {\n          const reader = new FileReader();\n          reader.onload = (e: ProgressEvent) => {\n            const fr = e.currentTarget as FileReader;\n            this.editorService.insertImage(fr.result.toString());\n          };\n          reader.readAsDataURL(blob);\n        });\n        //\n      }\n    }\n    event.srcElement.value = \"\";\n  }\n\n\n  emitMarkdown() {\n    this.markdownEmitter.emit(true);\n  }\n\n  watchUploadImage(response: HttpResponse<{ imageUrl: string }>, event) {\n    const { imageUrl } = response.body;\n    this.editorService.insertImage(imageUrl);\n    event.srcElement.value = null;\n  }\n\n  /**\n   * Set custom class\n   */\n  setCustomClass(classId: string) {\n    if (classId === '-1') {\n      this.execute.emit('clear');\n    } else {\n      this.editorService.createCustomClass(this._customClasses[+classId]);\n    }\n  }\n\n  focus() {\n    this.execute.emit('focus');\n    console.log('focused');\n  }\n}\n","import {\n  Attribute,\n  Component,\n  ElementRef,\n  EventEmitter,\n  forwardRef, HostBinding,\n  HostListener,\n  Input,\n  OnInit,\n  Output,\n  Renderer2,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport {ControlValueAccessor, NG_VALUE_ACCESSOR} from '@angular/forms';\nimport {isDefined} from '../utils';\n\nexport interface SelectOption {\n  label: string;\n  value: string;\n}\n\n@Component({\n  selector: 'ae-select',\n  templateUrl: './ae-select.component.html',\n  styleUrls: ['./ae-select.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => AeSelectComponent),\n      multi: true,\n    }\n  ]\n})\nexport class AeSelectComponent implements OnInit, ControlValueAccessor {\n  @Input() options: SelectOption[] = [];\n  // tslint:disable-next-line:no-input-rename\n  @Input('hidden') isHidden: boolean;\n\n  selectedOption: SelectOption;\n  disabled = false;\n  optionId = 0;\n\n  get label(): string {\n    return this.selectedOption && this.selectedOption.hasOwnProperty('label') ? this.selectedOption.label : 'Select';\n  }\n\n  opened = false;\n\n  get value(): string {\n    return this.selectedOption.value;\n  }\n\n  @HostBinding('style.display') hidden = 'inline-block';\n\n  // tslint:disable-next-line:no-output-native no-output-rename\n  @Output('change') changeEvent = new EventEmitter();\n\n  @ViewChild('labelButton', {static: true}) labelButton: ElementRef;\n\n  constructor(private elRef: ElementRef,\n              private r: Renderer2,\n  ) {}\n\n  ngOnInit() {\n    this.selectedOption = this.options[0];\n    if (isDefined(this.isHidden) && this.isHidden) {\n      this.hide();\n    }\n  }\n\n  hide() {\n    this.hidden = 'none';\n  }\n\n  optionSelect(option: SelectOption, event: MouseEvent) {\n    event.stopPropagation();\n    this.setValue(option.value);\n    this.onChange(this.selectedOption.value);\n    this.changeEvent.emit(this.selectedOption.value);\n    this.onTouched();\n    this.opened = false;\n  }\n\n  toggleOpen(event: MouseEvent) {\n    // event.stopPropagation();\n    if (this.disabled) {\n      return;\n    }\n    this.opened = !this.opened;\n  }\n\n  @HostListener('document:click', ['$event'])\n  onClick($event: MouseEvent) {\n    if (!this.elRef.nativeElement.contains($event.target)) {\n      this.close();\n    }\n  }\n\n  close() {\n    this.opened = false;\n  }\n\n  get isOpen(): boolean {\n    return this.opened;\n  }\n\n  writeValue(value) {\n    if (!value || typeof value !== 'string') {\n      return;\n    }\n    this.setValue(value);\n  }\n\n  setValue(value) {\n    let index = 0;\n    const selectedEl = this.options.find((el, i) => {\n      index = i;\n      return el.value === value;\n    });\n    if (selectedEl) {\n      this.selectedOption = selectedEl;\n      this.optionId = index;\n    }\n  }\n\n  onChange: any = () => {\n  }\n  onTouched: any = () => {\n  }\n\n  registerOnChange(fn) {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn) {\n    this.onTouched = fn;\n  }\n\n  setDisabledState(isDisabled: boolean): void {\n    this.labelButton.nativeElement.disabled = isDisabled;\n    const div = this.labelButton.nativeElement;\n    const action = isDisabled ? 'addClass' : 'removeClass';\n    this.r[action](div, 'disabled');\n    this.disabled = isDisabled;\n  }\n\n  @HostListener('keydown', ['$event'])\n  handleKeyDown($event: KeyboardEvent) {\n    if (!this.opened) {\n      return;\n    }\n    // console.log($event.key);\n    // if (KeyCode[$event.key]) {\n    switch ($event.key) {\n      case 'ArrowDown':\n        this._handleArrowDown($event);\n        break;\n      case 'ArrowUp':\n        this._handleArrowUp($event);\n        break;\n      case 'Space':\n        this._handleSpace($event);\n        break;\n      case 'Enter':\n        this._handleEnter($event);\n        break;\n      case 'Tab':\n        this._handleTab($event);\n        break;\n      case 'Escape':\n        this.close();\n        $event.preventDefault();\n        break;\n      case 'Backspace':\n        this._handleBackspace();\n        break;\n    }\n    // } else if ($event.key && $event.key.length === 1) {\n    // this._keyPress$.next($event.key.toLocaleLowerCase());\n    // }\n  }\n\n  _handleArrowDown($event) {\n    if (this.optionId < this.options.length - 1) {\n      this.optionId++;\n    }\n  }\n\n  _handleArrowUp($event) {\n    if (this.optionId >= 1) {\n      this.optionId--;\n    }\n  }\n\n  _handleSpace($event) {\n\n  }\n\n  _handleEnter($event) {\n    this.optionSelect(this.options[this.optionId], $event);\n  }\n\n  _handleTab($event) {\n\n  }\n\n  _handleBackspace() {\n\n  }\n}\n","import {NgModule} from '@angular/core';\nimport {AngularEditorComponent} from './angular-editor.component';\nimport {AEButtonIsHiddenPipe, AngularEditorToolbarComponent} from './angular-editor-toolbar.component';\nimport {FormsModule, ReactiveFormsModule} from '@angular/forms';\nimport {CommonModule} from '@angular/common';\nimport { AeSelectComponent } from './ae-select/ae-select.component';\nimport { AngularEditorService } from './angular-editor.service';\nimport { ImageResizeService } from './image-resize.service';\n\n@NgModule({\n  imports: [\n    CommonModule, FormsModule, ReactiveFormsModule\n  ],\n  declarations: [\n    AngularEditorComponent,\n    AngularEditorToolbarComponent,\n    AeSelectComponent,\n    AEButtonIsHiddenPipe\n  ],\n  // providers: [\n  //   AngularEditorService,\n  //   ImageResizeService\n  // ],\n  exports: [\n    AngularEditorComponent,\n    AngularEditorToolbarComponent\n  ]\n})\nexport class AngularEditorModule {\n}\n"]}